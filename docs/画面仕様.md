# 画面仕様書

本仕様書では、以下のデータモデルと機能を前提とした画面単位の機能・項目を整理する。

---

## データモデル概要

- **Version（デスク環境バージョン）**  
  | フィールド       | 型      | 説明                                     |
  |:----------------|:--------|:-----------------------------------------|
  | `id`            | int     | ユニークID                               |
  | `versionName`   | string  | バージョン名                             |
  | `startPeriod`   | date    | 始期                                     |
  | `endPeriod`     | date    | 終期                                     |
  | `item_ids`      | int[]   | 紐づくアイテムIDの配列                    |

- **Item（アイテム）**  
  | フィールド       | 型     | 説明                                        |
  |:----------------|:-------|:--------------------------------------------|
  | `id`            | int    | ユニークID                                  |
  | `name`          | string | アイテム名                                  |
  | `category`      | string | カテゴリ（例: PC, モニタ, etc.）             |
  | `productLink`   | string | 商品リンク（URL など）                       |

---

## 1. トップ画面 (index.html)

### パス / メソッド
- `GET /`

### 表示内容
1. **画面タイトル**  
   - 「Desk SetUp Management」

2. **デスク環境バージョン一覧**  
   - 一覧表示形式  
     - 始期の降順でソート
   - 各バージョンには以下の情報を表示
     - バージョン名
       - クリックすると「デスク環境バージョン詳細画面」へ遷移
     - 始期
       - yyyy年MM月形式でフォーマット
       - 元データがyyyy-mm-dd形式ではない場合は、エラー文言を表示
     - 終期
       - yyyy年MM月形式でフォーマット
       - 元データがyyyy-mm-dd形式ではない場合は、エラー文言を表示
   - バージョンが登録されていない場合は「まだ登録がありません。」等のメッセージを表示

3. **遷移ボタン**  
   - 「デスクバージョン新規登録」 → `GET /version/new`  
   - 「アイテム一覧」 → `GET /items`

---

## 2. デスク環境バージョン新規登録画面 (version_new.html)

### パス / メソッド
- `GET /version/new` : 画面表示
- `POST /version/new` : バージョン登録実行

### 表示内容
1. **フォーム：バージョン情報**  
   - バージョン名 (`versionName`)  
     - 必須項目
   - 始期 (`startPeriod`)  
     - 必須項目
     - yyyy-mm-dd形式で登録する
   
2. **直前バージョンの参照**  
   - もし既に登録されたバージョンがあれば、「バージョン名」「始期」等を表示して参考にできるようにする
   - 直前のバージョンがない場合は「まだ登録がありません。」等のメッセージを表示

3. **既存アイテムのアタッチ**  
   - 登録済みアイテム一覧をチェックボックスなどで表示  
   - 直前のバージョンに紐づいているアイテムは、デフォルトでチェックされている状態にする
   - 選択されたアイテムIDをこのバージョンに紐づける
   

4. **アイテム新規登録（同時アタッチ）**  
   - アイテム名 (`new_item_name`)、カテゴリ (`new_item_category`)、商品リンク (`new_item_link`)  
   - 入力されたアイテムを新規作成すると同時に、当該バージョンへ紐づけ

5. **登録ボタン**
   - 送信先: `POST /version/new`  
   - バージョンを保存し、指定されたアイテムを紐づけ → **バージョン詳細画面**へリダイレクト
   - この際、直前バージョンの終期の日付を、新規バージョンの始期の日付で更新する

6. **トップ画面へ戻るリンク**
   - `GET /`

---

## 3. デスク環境バージョン詳細画面 (version_detail.html)

### パス / メソッド
- `GET /version/<int:version_id>` : 詳細画面表示
- `POST /version/<int:version_id>/update` : バージョン情報(名前/始期)の更新
- `POST /version/<int:version_id>/add_item` : アイテムのアタッチ (既存 or 新規)
- `POST /version/<int:version_id>/remove_item` : アイテムのデタッチ

### 表示内容

1. **バージョン情報（編集可能）**  
   - バージョン名  
   - 始期 (yyyy-mm-dd形式)  
     - 編集可能
     - 編集した場合、直前のバージョンの終期が自動的に更新される
   - 終期 (yyyy-mm-dd形式)  
     - 表示のみ（編集不可）
     - 次のバージョンの始期が自動的に設定される
   - 更新ボタン押下で `POST /version/<id>/update`

2. **紐づくアイテム一覧**  
   - アイテム名, カテゴリ, 商品リンク  
     - 商品リンクがある場合は、リンクとして表示
   - 各アイテムの右側に「削除」ボタン（`POST /version/<id>/remove_item`）  
   - 押下すると該当アイテムがこのバージョンからデタッチされる

3. **アイテム追加**  
   - **既存アイテムの追加**
     - 登録済みアイテム一覧をチェックボックスなどで表示
     - 選択して追加ボタン押下 → `POST /version/<id>/add_item`
   - **新規アイテムの追加**
     - アイテム名（必須）
     - カテゴリ（必須）
     - 商品リンク（任意）
     - 登録ボタン押下 → 同じく `POST /version/<id>/add_item` 内で作成 → バージョンへアタッチ

4. **前後のバージョンへのリンク**
   - 前のバージョン（startPeriodが現在のバージョンより前で最も近いもの）
   - 次のバージョン（startPeriodが現在のバージョンより後で最も近いもの）
   - それぞれ存在しない場合は非表示

5. **トップ画面へ戻るリンク**  
   - `GET /`

---

## 4. アイテム一覧画面 (items.html)

### パス / メソッド
- `GET /items` : 一覧表示
- `POST /items` : 新規アイテム登録

### 表示内容
1. **アイテム新規登録フォーム**  
   - アイテム名 (`name`)  
     - 必須項目
   - カテゴリ (`category`)  
     - 必須項目
   - 商品リンク (`productLink`)  
     - 任意項目
   - 送信先: `POST /items`  
   - 登録後、同画面にリダイレクトされ一覧が更新

2. **アイテム一覧**  
   - アイテム情報（カテゴリ毎に分類して表示）
     - アイテム名
     - 商品リンク（リンクがある場合のみ表示）
   - 使用状況
     - 「このアイテムを使用しているバージョン一覧」を表示
     - バージョン名、期間（yyyy年MM月形式）を表示
     - 例: 「八潮２ (2025年03月 ~ 2025年04月)」
     - 使用しているバージョンがない場合は「なし」と表示
   - 操作ボタン
     - **編集ボタン** → `GET /items/<int:item_id>/edit`  
     - **削除ボタン** → `POST /items/<int:item_id>/delete`  
       - どのバージョンでも使用されていない場合のみ表示
       - 使用中の場合は削除ボタンを非表示

3. **トップ画面へ戻るリンク**  
   - `GET /`

### 補足
- アイテムの表示順は、カテゴリ別にアイテム名でソート
- 商品リンクは、リンクがある場合のみ表示
- バージョン一覧は始期の降順でソート
- カテゴリは将来的にマスタ管理する可能性を考慮（現状は自由入力）

---

## 5. アイテム編集画面 (item_edit.html)

### パス / メソッド
- `GET /items/<int:item_id>/edit` : 編集画面表示
- `POST /items/<int:item_id>/update` : 更新

### 表示内容
1. **アイテム編集フォーム**  
   - 名前, カテゴリ, 商品リンク (既存値をデフォルト表示)  
   - 更新ボタン → `POST /items/<int:item_id>/update`

2. **アイテム一覧へ戻るリンク**  
   - `GET /items`

---

## 補足

- **バリデーション**
  - 始期/終期の yyyymm形式は文字列のフォーマットチェックを簡易的に行う想定
  - 必須項目（バージョン名、アイテム名など）には required 属性などで入力必須を促す
- **データの永続化**
  - `versions.json`, `items.json` に読み書き
- **ソート**
  - トップ画面におけるバージョン一覧の表示順は `startPeriod` → `endPeriod` の昇順など、運用に応じてカスタマイズ可能
- **アイテム削除時の制約**
  - バージョンが参照中（`items`配列にIDが含まれる）の場合は削除不可
- **画面遷移フロー**
  1. トップ画面 (バージョン一覧)  
  2. バージョン新規登録 or 既存バージョン詳細  
  3. アイテム一覧 or アイテム編集  
  - それぞれの更新後は適宜、一覧 or 詳細画面にリダイレクトする

