# 画面仕様書

本仕様書では、以下のデータモデルと機能を前提とした画面単位の機能・項目を整理する。

---

## データモデル概要

- **Version（デスク環境バージョン）**  
  | フィールド       | 型      | 説明                                     |
  |:----------------|:--------|:-----------------------------------------|
  | `id`            | int     | ユニークID                               |
  | `versionName`   | string  | バージョン名                             |
  | `startPeriod`   | string  | 始期（yyyymm形式）                       |
  | `endPeriod`     | string  | 終期（yyyymm形式）                       |
  | `items`         | int[]   | 紐づくアイテムIDの配列                    |

- **Item（アイテム）**  
  | フィールド       | 型     | 説明                                        |
  |:----------------|:-------|:--------------------------------------------|
  | `id`            | int    | ユニークID                                  |
  | `name`          | string | アイテム名                                  |
  | `category`      | string | カテゴリ（例: PC, モニタ, etc.）             |
  | `productLink`   | string | 商品リンク（URL など）                       |

---

## 1. トップ画面 (index.html)

### パス / メソッド
- `GET /`

### 表示内容
1. **画面タイトル**  
   - 「Desk Environment Management」

2. **デスク環境バージョン一覧**  
   - 一覧表示形式  
   - バージョン名（クリックすると「デスク環境バージョン詳細画面」へ遷移）  
   - 始期（yyyymm）  
   - 終期（yyyymm）  
   - バージョンが登録されていない場合は「まだ登録がありません。」等のメッセージを表示

3. **遷移ボタン**  
   - 「デスクバージョン新規登録」 → `GET /version/new`  
   - 「アイテム一覧」 → `GET /items`

---

## 2. デスク環境バージョン新規登録画面 (version_new.html)

### パス / メソッド
- `GET /version/new` : 画面表示
- `POST /version/new` : バージョン登録実行

### 表示内容
1. **フォーム：バージョン情報**  
   - バージョン名 (`versionName`)  
   - 始期 (`startPeriod`, yyyymm形式)  
   - 終期 (`endPeriod`, yyyymm形式)
   
2. **直前バージョンの参照**  
   - もし既に登録されたバージョンがあれば、「バージョン名」「始期〜終期」等を簡易的に表示して参考にできるようにする

3. **既存アイテムのアタッチ**  
   - 登録済みアイテム一覧をチェックボックスなどで表示  
   - 選択されたアイテムIDをこのバージョンに紐づける

4. **アイテム新規登録（同時アタッチ）**  
   - アイテム名 (`new_item_name`)、カテゴリ (`new_item_category`)、商品リンク (`new_item_link`)  
   - 入力されたアイテムを新規作成すると同時に、当該バージョンへ紐づけ

5. **登録ボタン**
   - 送信先: `POST /version/new`  
   - バージョンを保存し、指定されたアイテムを紐づけ → **バージョン詳細画面**へリダイレクト

6. **トップ画面へ戻るリンク**
   - `GET /`

---

## 3. デスク環境バージョン詳細画面 (version_detail.html)

### パス / メソッド
- `GET /version/<int:version_id>` : 詳細画面表示
- `POST /version/<int:version_id>/update` : バージョン情報(名前/始期/終期)の更新
- `POST /version/<int:version_id>/add_item` : アイテムのアタッチ (既存 or 新規)
- `POST /version/<int:version_id>/remove_item` : アイテムのデタッチ

### 表示内容

1. **バージョン情報（編集可能）**  
   - バージョン名  
   - 始期 (yyyymm形式)  
   - 終期 (yyyymm形式)  
   - 更新ボタン押下で `POST /version/<id>/update`

2. **紐づくアイテム一覧**  
   - アイテム名, カテゴリ, 商品リンク  
   - 各アイテムの右側に「削除」ボタン（`POST /version/<id>/remove_item`）  
   - 押下すると該当アイテムがこのバージョンからデタッチされる

3. **アイテム追加**  
   - 既存アイテムを選択 → `POST /version/<id>/add_item`  
   - 新規アイテムを登録 → 同じく `POST /version/<id>/add_item` 内で作成 → バージョンへアタッチ

4. **トップ画面へ戻るリンク**  
   - `GET /`

---

## 4. アイテム一覧画面 (items.html)

### パス / メソッド
- `GET /items` : 一覧表示
- `POST /items` : 新規アイテム登録

### 表示内容
1. **アイテム一覧**  
   - (ID) 名前, カテゴリ, 商品リンク  
   - 「このアイテムを使用しているバージョン一覧」を表示  
     - 例: 「Ver.3: '引越し後セットアップ' (202501 ~ 202503)」など

2. **アイテム新規登録フォーム**  
   - 名前, カテゴリ, 商品リンク  
   - 送信先: `POST /items`  
   - 登録後、同画面にリダイレクトされ一覧が更新

3. **アイテム編集 / 削除**  
   - **編集ボタン** → `GET /items/<int:item_id>/edit`  
   - **削除ボタン** → `POST /items/<int:item_id>/delete`  
     - どのバージョンでも使用されていない場合のみ削除可能

4. **トップ画面へ戻るリンク**  
   - `GET /`

---

## 5. アイテム編集画面 (item_edit.html)

### パス / メソッド
- `GET /items/<int:item_id>/edit` : 編集画面表示
- `POST /items/<int:item_id>/update` : 更新

### 表示内容
1. **アイテム編集フォーム**  
   - 名前, カテゴリ, 商品リンク (既存値をデフォルト表示)  
   - 更新ボタン → `POST /items/<int:item_id>/update`

2. **アイテム一覧へ戻るリンク**  
   - `GET /items`

---

## 補足

- **バリデーション**
  - 始期/終期の yyyymm形式は文字列のフォーマットチェックを簡易的に行う想定
  - 必須項目（バージョン名、アイテム名など）には required 属性などで入力必須を促す
- **データの永続化**
  - `versions.json`, `items.json` に読み書き
- **ソート**
  - トップ画面におけるバージョン一覧の表示順は `startPeriod` → `endPeriod` の昇順など、運用に応じてカスタマイズ可能
- **アイテム削除時の制約**
  - バージョンが参照中（`items`配列にIDが含まれる）の場合は削除不可
- **画面遷移フロー**
  1. トップ画面 (バージョン一覧)  
  2. バージョン新規登録 or 既存バージョン詳細  
  3. アイテム一覧 or アイテム編集  
  - それぞれの更新後は適宜、一覧 or 詳細画面にリダイレクトする

